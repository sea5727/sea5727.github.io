---
layout: posts
title: "janus 시작하기 #2"
date: 2021-04-27 02:32:12 +0900
categories: summary janus
tag:
- janus
blog: true
author: ysh
description: 
sidebar:
  nav: "posts_navi"
---

## run janus
janus 를 실행하여 echo test demo를 실행해보겠습니다.
http server와 janus를 실행해둔상태로 진행하여야 합니다.
설치법과 기본 실행방법은 [start janus](2021-04-26-janus_start.md) 페이지를 참고하세요.


### echo test
demos > Echo Test > Start 를 선택합니다.
chrome 개발자 도구에서 *WebRTC error: getUserMedia not available* 라는 오류가 발생하네요.
WebRTC는 https가 기본인듯 합니다 ( chrome만 그런지는 모르겠습니다. 프론트 개발자가 아니어서요. )

### create certificate 
https를 위한 인증서를 생성해줍니다.
[HTTPS 관련 내용 보기]()
```
openssl req -newkey rsa:2048 -new -nodes -x509 -days 3650 -keyout key.pem -out cert.pem
mkdir -p /opt/cert
mv key.pem /opt/cert
mv cert.pem /opt/cert
```

### edit config
https를 janus 설정에 추가해주어야 합니다.

#### janus folder architecture 

- bin : janus binary 폴더
- etc : config 폴더
- include : plugin include 폴더 (?)
- lib : plugin library 폴더 (?)
- share : script, javascript, demos 같은 유틸 폴더 (?)

#### janus configuration
`<janus-home>/etc/janus/` 폴더에는 여러 설정 파일의 sample들이 있습니다. 사용할 설정 파일은 이름에서 sample을 지우고 사용하면 됩니다.

`janus.jcfg`와 `janus.transport.http.jcfg` 설정 파일은 필수인듯 보입니다.

- janus.jcfg : 일반 설정. 설정 파일이나 플러그인 위치를 명시하거나 로그 포맷, binary 기동 규칙(background or foreground), 로그레벨 등을 설정
- janus.transport.http.jcfg.sample : 웹 서버 관련. `web-front` 가 접속할 포트, ssl포트, BASE-URL등을 설정. 
- janus.transport.pfunix.jcfg.sample : `Unix Socket` 을 사용할 수 있도록 하는 설정. unix socket path나 활성화 유무등을 설정.
- janus.transport.websocket.jcfg : `websocket` 관련 설정. (어떤것을 할 수 있는 설정일까?)
- janus.plugin.<demo-name>.jcfg : 각종 데모관련 설정 파일 ( 추측 )

#### janus.transport.http.jcfg.sample
generl.https, secore_port, certificates.cert_pem, cert_key 설정 파라미터들을 아래와 같이 변경하였습니다.

``` conf
general: {
        json = "indented"
        base_path = "/janus"
        http = true
        port = 8088
        https = true
        secure_port = 8089
}

admin: {
        admin_base_path = "/admin"
        admin_http = false
        admin_port = 7088
        admin_https = false
}

cors: {
}

certificates: {
        cert_pem = "/opt/cert/cert.pem"
        cert_key = "/opt/cert/key.pem"
}

```

### rerun janus
janus를 재기동해줍니다.
```
cd /opt/janus
./bin/janus -b
```

### start https server
http 서버는 `python3 -m http.server` 로 실행하였습니다.
https는 간단하게 파이썬 스크립트를 작성하여 동작시키도록 하겠습니다.
``` python
import http.server, ssl

server_address = ('0.0.0.0', 443)
httpd = http.server.HTTPServer(server_address, http.server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket(httpd.socket,
                               server_side=True,
                               certfile='/opt/cert/https-cert.pem', keyfile='/opt/cert/https-key.pem',
                               ssl_version=ssl.PROTOCOL_TLS)
httpd.serve_forever()
```

https 서버를 실행합니다.
```
cd /opt/janus/share/janus/demos
python3 <https-server-path>
```

### re echo test
`web browser` 에서 `https://<URL>` 로 접속을 합니다. 그리고 demos > echo test > start 를 실행하면 아래화면을 보실 수 있습니다.

<img src="../_assets/_images/2021-04-27-janus_run_image1" alt="drawing" width="480" height="320"/>